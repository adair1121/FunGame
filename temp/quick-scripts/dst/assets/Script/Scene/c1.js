
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Scene/c1.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '92a4cw3eQJKNpL3ahItcgLN', 'c1');
// Script/Scene/c1.js

"use strict";

var global = require("global");

cc.Class({
  "extends": cc.Component,
  properties: {
    restart: {
      "default": null,
      type: cc.Node
    },
    num: {
      "default": null,
      type: cc.Label
    },
    map: {
      "default": null,
      type: cc.Node
    },
    block: {
      "default": [],
      type: cc.Prefab
    },
    tips: {
      "default": null,
      type: cc.Label
    },
    stage: {
      "default": null,
      type: cc.Node
    },
    boo: {
      "default": null,
      type: cc.Node
    },
    bg: {
      "default": null,
      type: cc.Node
    }
  },
  // use this for initialization
  onLoad: function onLoad() {
    if (typeof wx != "undefined") {
      wx.showShareMenu({
        withShareTicket: true
      });
      wx.updateShareMenu({
        withShareTicket: true
      });
      wx.onShareAppMessage(function () {
        // 用户点击了“转发”按钮
        return {
          title: '小卜与花生的故事，想要讲给你听……',
          imageUrl: "res/raw-assets/Texture/share/s3.png",
          success: function success(res) {}
        };
      });
      wx.showModal({
        title: '小卜:',
        content: '这里是练习模式，没有分数和排行，只有一个小故事，随时可以点击左下角按钮退出',
        success: function success(res) {},
        fail: function fail(argument) {}
      });
    }

    global.game = this;
    var manager = cc.director.getCollisionManager();
    manager.enabled = true; // manager.enabledDebugDraw = true;
    // manager.enabledDrawBoundingBox = true;

    global.bonus = 0;
    this.boo.ori_xv = 1;
    this.boo.ori_xa = 0.2;
    this.boo.xv = this.boo.ori_xv;
    this.boo.xa = this.boo.ori_xa;
    global.distance = 0;
    global.num = 0;
    global.gameover = false;
    global.word = 0;
    this.edge = 0;
    this.boo_move = false;
    this.node.on('touchstart', function (event) {
      if (!global.gameover) {
        this.boo.xv = this.boo.ori_xv;
        this.boo.xa = this.boo.ori_xa;
        this.boo_move = true;
      }
    }, this);
    this.node.on('touchend', function (event) {
      this.boo_move = false;
    }, this);
    this.restart.on('touchstart', function (event) {
      cc.game.restart();
    }, this);
  },
  setBLock: function setBLock() {
    var block = cc.instantiate(this.block[0]);
    block.setPosition(global.distance + 400, -100);
    block.mode = "c1";
    block.parent = this.map;
  },
  setNum: function setNum(num) {
    global.num += num + global.bonus;
    this.num.string = global.num;
  },
  setTip: function setTip(str) {
    this.tips.string = str;
  },
  end: function end() {
    global.gameover = true;

    if (typeof wx != "undefined") {
      wx.showModal({
        title: '小卜:',
        content: '返回主菜单咯~',
        success: function success(res) {
          cc.game.restart();
        },
        fail: function fail(argument) {
          cc.game.restart();
        }
      });
    }
  },
  // called every frame, uncomment this function to activate update callback
  update: function update(dt) {
    /*var color = this.bg.color;
    if (color.equals(cc.Color.BLACK)) {
        return;
    }*/
    // this.ratio += dt * 0.01;
    // this.bg.color = cc.Color.WHITE.lerp(cc.Color.WHITE, this.ratio);
    if (this.boo_move) {
      global.distance += this.boo.xv;
      this.map.x -= this.boo.xv;
      this.boo.xv += this.boo.xa; // this.boo.xv = Math.min(this.boo.xv, 10)

      if (global.distance > this.edge) {
        this.edge += 200 + Math.seededRandom() * 50 + this.boo.xv * this.boo.xv;
        this.setBLock();

        if (global.num % 50 > 45) {
          var action = cc.tintTo(2, Math.seededRandom() * 255, Math.seededRandom() * 255, Math.seededRandom() * 255);
          this.bg.runAction(action);
        }
      }
    }

    if (!global.gameover) {
      if (this.boo.y > 400) {
        this.stage.scaleX = Math.max(0.2, 1 - (this.boo.y - 400) / 1000);
        this.stage.scaleY = Math.max(0.2, 1 - (this.boo.y - 400) / 1000);
      } else {
        this.stage.scaleX = 1;
        this.stage.scaleY = 1;
      }
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvU2NlbmUvYzEuanMiXSwibmFtZXMiOlsiZ2xvYmFsIiwicmVxdWlyZSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwicmVzdGFydCIsInR5cGUiLCJOb2RlIiwibnVtIiwiTGFiZWwiLCJtYXAiLCJibG9jayIsIlByZWZhYiIsInRpcHMiLCJzdGFnZSIsImJvbyIsImJnIiwib25Mb2FkIiwid3giLCJzaG93U2hhcmVNZW51Iiwid2l0aFNoYXJlVGlja2V0IiwidXBkYXRlU2hhcmVNZW51Iiwib25TaGFyZUFwcE1lc3NhZ2UiLCJ0aXRsZSIsImltYWdlVXJsIiwic3VjY2VzcyIsInJlcyIsInNob3dNb2RhbCIsImNvbnRlbnQiLCJmYWlsIiwiYXJndW1lbnQiLCJnYW1lIiwibWFuYWdlciIsImRpcmVjdG9yIiwiZ2V0Q29sbGlzaW9uTWFuYWdlciIsImVuYWJsZWQiLCJib251cyIsIm9yaV94diIsIm9yaV94YSIsInh2IiwieGEiLCJkaXN0YW5jZSIsImdhbWVvdmVyIiwid29yZCIsImVkZ2UiLCJib29fbW92ZSIsIm5vZGUiLCJvbiIsImV2ZW50Iiwic2V0QkxvY2siLCJpbnN0YW50aWF0ZSIsInNldFBvc2l0aW9uIiwibW9kZSIsInBhcmVudCIsInNldE51bSIsInN0cmluZyIsInNldFRpcCIsInN0ciIsImVuZCIsInVwZGF0ZSIsImR0IiwieCIsIk1hdGgiLCJzZWVkZWRSYW5kb20iLCJhY3Rpb24iLCJ0aW50VG8iLCJydW5BY3Rpb24iLCJ5Iiwic2NhbGVYIiwibWF4Iiwic2NhbGVZIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLE1BQU0sR0FBR0MsT0FBTyxDQUFDLFFBQUQsQ0FBcEI7O0FBQ0FDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxPQUFPLEVBQUU7QUFDTCxpQkFBUyxJQURKO0FBRUxDLE1BQUFBLElBQUksRUFBRUwsRUFBRSxDQUFDTTtBQUZKLEtBREQ7QUFLUkMsSUFBQUEsR0FBRyxFQUFFO0FBQ0QsaUJBQVMsSUFEUjtBQUVERixNQUFBQSxJQUFJLEVBQUVMLEVBQUUsQ0FBQ1E7QUFGUixLQUxHO0FBU1JDLElBQUFBLEdBQUcsRUFBRTtBQUNELGlCQUFTLElBRFI7QUFFREosTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNNO0FBRlIsS0FURztBQWFSSSxJQUFBQSxLQUFLLEVBQUU7QUFDSCxpQkFBUyxFQUROO0FBRUhMLE1BQUFBLElBQUksRUFBRUwsRUFBRSxDQUFDVztBQUZOLEtBYkM7QUFpQlJDLElBQUFBLElBQUksRUFBRTtBQUNGLGlCQUFTLElBRFA7QUFFRlAsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNRO0FBRlAsS0FqQkU7QUFxQlJLLElBQUFBLEtBQUssRUFBRTtBQUNILGlCQUFTLElBRE47QUFFSFIsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNNO0FBRk4sS0FyQkM7QUF5QlJRLElBQUFBLEdBQUcsRUFBRTtBQUNELGlCQUFTLElBRFI7QUFFRFQsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNNO0FBRlIsS0F6Qkc7QUE2QlJTLElBQUFBLEVBQUUsRUFBRTtBQUNBLGlCQUFTLElBRFQ7QUFFQVYsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNNO0FBRlQ7QUE3QkksR0FIUDtBQXNDTDtBQUNBVSxFQUFBQSxNQUFNLEVBQUUsa0JBQVk7QUFFaEIsUUFBRyxPQUFPQyxFQUFQLElBQWMsV0FBakIsRUFBOEI7QUFDMUJBLE1BQUFBLEVBQUUsQ0FBQ0MsYUFBSCxDQUFpQjtBQUNmQyxRQUFBQSxlQUFlLEVBQUU7QUFERixPQUFqQjtBQUlBRixNQUFBQSxFQUFFLENBQUNHLGVBQUgsQ0FBbUI7QUFDakJELFFBQUFBLGVBQWUsRUFBRTtBQURBLE9BQW5CO0FBSUFGLE1BQUFBLEVBQUUsQ0FBQ0ksaUJBQUgsQ0FBcUIsWUFBWTtBQUMvQjtBQUNBLGVBQU87QUFDTEMsVUFBQUEsS0FBSyxFQUFFLG1CQURGO0FBRUxDLFVBQUFBLFFBQVEsRUFBRSxxQ0FGTDtBQUdMQyxVQUFBQSxPQUFPLEVBQUUsaUJBQVNDLEdBQVQsRUFBYyxDQUN0QjtBQUpJLFNBQVA7QUFNRCxPQVJEO0FBVUFSLE1BQUFBLEVBQUUsQ0FBQ1MsU0FBSCxDQUFhO0FBQ1RKLFFBQUFBLEtBQUssRUFBRSxLQURFO0FBRVRLLFFBQUFBLE9BQU8sRUFBRSx1Q0FGQTtBQUdUSCxRQUFBQSxPQUFPLEVBQUUsaUJBQVVDLEdBQVYsRUFBZSxDQUV2QixDQUxRO0FBTVRHLFFBQUFBLElBQUksRUFBRSxjQUFVQyxRQUFWLEVBQW9CLENBRXpCO0FBUlEsT0FBYjtBQVVIOztBQUVEL0IsSUFBQUEsTUFBTSxDQUFDZ0MsSUFBUCxHQUFjLElBQWQ7QUFFQSxRQUFJQyxPQUFPLEdBQUcvQixFQUFFLENBQUNnQyxRQUFILENBQVlDLG1CQUFaLEVBQWQ7QUFDQUYsSUFBQUEsT0FBTyxDQUFDRyxPQUFSLEdBQWtCLElBQWxCLENBcENnQixDQXFDaEI7QUFDQTs7QUFFQXBDLElBQUFBLE1BQU0sQ0FBQ3FDLEtBQVAsR0FBZSxDQUFmO0FBRUEsU0FBS3JCLEdBQUwsQ0FBU3NCLE1BQVQsR0FBa0IsQ0FBbEI7QUFDQSxTQUFLdEIsR0FBTCxDQUFTdUIsTUFBVCxHQUFrQixHQUFsQjtBQUNBLFNBQUt2QixHQUFMLENBQVN3QixFQUFULEdBQWMsS0FBS3hCLEdBQUwsQ0FBU3NCLE1BQXZCO0FBQ0EsU0FBS3RCLEdBQUwsQ0FBU3lCLEVBQVQsR0FBYyxLQUFLekIsR0FBTCxDQUFTdUIsTUFBdkI7QUFFQXZDLElBQUFBLE1BQU0sQ0FBQzBDLFFBQVAsR0FBa0IsQ0FBbEI7QUFDQTFDLElBQUFBLE1BQU0sQ0FBQ1MsR0FBUCxHQUFhLENBQWI7QUFDQVQsSUFBQUEsTUFBTSxDQUFDMkMsUUFBUCxHQUFrQixLQUFsQjtBQUVBM0MsSUFBQUEsTUFBTSxDQUFDNEMsSUFBUCxHQUFjLENBQWQ7QUFFQSxTQUFLQyxJQUFMLEdBQVksQ0FBWjtBQUVBLFNBQUtDLFFBQUwsR0FBZ0IsS0FBaEI7QUFFQSxTQUFLQyxJQUFMLENBQVVDLEVBQVYsQ0FBYSxZQUFiLEVBQTJCLFVBQVdDLEtBQVgsRUFBbUI7QUFDMUMsVUFBRyxDQUFDakQsTUFBTSxDQUFDMkMsUUFBWCxFQUFxQjtBQUNqQixhQUFLM0IsR0FBTCxDQUFTd0IsRUFBVCxHQUFjLEtBQUt4QixHQUFMLENBQVNzQixNQUF2QjtBQUNBLGFBQUt0QixHQUFMLENBQVN5QixFQUFULEdBQWMsS0FBS3pCLEdBQUwsQ0FBU3VCLE1BQXZCO0FBQ0EsYUFBS08sUUFBTCxHQUFnQixJQUFoQjtBQUNIO0FBQ0osS0FORCxFQU1HLElBTkg7QUFPQSxTQUFLQyxJQUFMLENBQVVDLEVBQVYsQ0FBYSxVQUFiLEVBQXlCLFVBQVdDLEtBQVgsRUFBbUI7QUFDeEMsV0FBS0gsUUFBTCxHQUFnQixLQUFoQjtBQUNILEtBRkQsRUFFRyxJQUZIO0FBS0EsU0FBS3hDLE9BQUwsQ0FBYTBDLEVBQWIsQ0FBZ0IsWUFBaEIsRUFBOEIsVUFBV0MsS0FBWCxFQUFtQjtBQUM3Qy9DLE1BQUFBLEVBQUUsQ0FBQzhCLElBQUgsQ0FBUTFCLE9BQVI7QUFDSCxLQUZELEVBRUcsSUFGSDtBQUlILEdBaEhJO0FBa0hMNEMsRUFBQUEsUUFBUSxFQUFFLG9CQUFXO0FBQ2pCLFFBQUl0QyxLQUFLLEdBQUdWLEVBQUUsQ0FBQ2lELFdBQUgsQ0FBZSxLQUFLdkMsS0FBTCxDQUFXLENBQVgsQ0FBZixDQUFaO0FBQ0FBLElBQUFBLEtBQUssQ0FBQ3dDLFdBQU4sQ0FBa0JwRCxNQUFNLENBQUMwQyxRQUFQLEdBQWtCLEdBQXBDLEVBQXlDLENBQUMsR0FBMUM7QUFDQTlCLElBQUFBLEtBQUssQ0FBQ3lDLElBQU4sR0FBYSxJQUFiO0FBRUF6QyxJQUFBQSxLQUFLLENBQUMwQyxNQUFOLEdBQWUsS0FBSzNDLEdBQXBCO0FBQ0gsR0F4SEk7QUEwSEw0QyxFQUFBQSxNQUFNLEVBQUUsZ0JBQVM5QyxHQUFULEVBQWM7QUFDbEJULElBQUFBLE1BQU0sQ0FBQ1MsR0FBUCxJQUFjQSxHQUFHLEdBQUdULE1BQU0sQ0FBQ3FDLEtBQTNCO0FBQ0EsU0FBSzVCLEdBQUwsQ0FBUytDLE1BQVQsR0FBa0J4RCxNQUFNLENBQUNTLEdBQXpCO0FBQ0gsR0E3SEk7QUErSExnRCxFQUFBQSxNQUFNLEVBQUUsZ0JBQVNDLEdBQVQsRUFBYztBQUNsQixTQUFLNUMsSUFBTCxDQUFVMEMsTUFBVixHQUFtQkUsR0FBbkI7QUFDSCxHQWpJSTtBQW1JTEMsRUFBQUEsR0FBRyxFQUFFLGVBQVc7QUFDWjNELElBQUFBLE1BQU0sQ0FBQzJDLFFBQVAsR0FBa0IsSUFBbEI7O0FBRUEsUUFBRyxPQUFPeEIsRUFBUCxJQUFjLFdBQWpCLEVBQThCO0FBQzFCQSxNQUFBQSxFQUFFLENBQUNTLFNBQUgsQ0FBYTtBQUNUSixRQUFBQSxLQUFLLEVBQUUsS0FERTtBQUVUSyxRQUFBQSxPQUFPLEVBQUUsU0FGQTtBQUdUSCxRQUFBQSxPQUFPLEVBQUUsaUJBQVVDLEdBQVYsRUFBZTtBQUNwQnpCLFVBQUFBLEVBQUUsQ0FBQzhCLElBQUgsQ0FBUTFCLE9BQVI7QUFDSCxTQUxRO0FBTVR3QixRQUFBQSxJQUFJLEVBQUUsY0FBVUMsUUFBVixFQUFvQjtBQUN0QjdCLFVBQUFBLEVBQUUsQ0FBQzhCLElBQUgsQ0FBUTFCLE9BQVI7QUFDSDtBQVJRLE9BQWI7QUFVSDtBQUNKLEdBbEpJO0FBb0pMO0FBQ0FzRCxFQUFBQSxNQUFNLEVBQUUsZ0JBQVVDLEVBQVYsRUFBYztBQUVsQjs7OztBQUlBO0FBQ0E7QUFFQSxRQUFHLEtBQUtmLFFBQVIsRUFBa0I7QUFDZDlDLE1BQUFBLE1BQU0sQ0FBQzBDLFFBQVAsSUFBbUIsS0FBSzFCLEdBQUwsQ0FBU3dCLEVBQTVCO0FBQ0EsV0FBSzdCLEdBQUwsQ0FBU21ELENBQVQsSUFBYyxLQUFLOUMsR0FBTCxDQUFTd0IsRUFBdkI7QUFDQSxXQUFLeEIsR0FBTCxDQUFTd0IsRUFBVCxJQUFlLEtBQUt4QixHQUFMLENBQVN5QixFQUF4QixDQUhjLENBSWQ7O0FBRUEsVUFBR3pDLE1BQU0sQ0FBQzBDLFFBQVAsR0FBa0IsS0FBS0csSUFBMUIsRUFBZ0M7QUFDNUIsYUFBS0EsSUFBTCxJQUFhLE1BQU1rQixJQUFJLENBQUNDLFlBQUwsS0FBc0IsRUFBNUIsR0FBaUMsS0FBS2hELEdBQUwsQ0FBU3dCLEVBQVQsR0FBYyxLQUFLeEIsR0FBTCxDQUFTd0IsRUFBckU7QUFDQSxhQUFLVSxRQUFMOztBQUNBLFlBQUdsRCxNQUFNLENBQUNTLEdBQVAsR0FBYSxFQUFiLEdBQWtCLEVBQXJCLEVBQXlCO0FBQ3JCLGNBQUl3RCxNQUFNLEdBQUcvRCxFQUFFLENBQUNnRSxNQUFILENBQVUsQ0FBVixFQUFhSCxJQUFJLENBQUNDLFlBQUwsS0FBc0IsR0FBbkMsRUFBd0NELElBQUksQ0FBQ0MsWUFBTCxLQUFzQixHQUE5RCxFQUFtRUQsSUFBSSxDQUFDQyxZQUFMLEtBQXNCLEdBQXpGLENBQWI7QUFDQSxlQUFLL0MsRUFBTCxDQUFRa0QsU0FBUixDQUFrQkYsTUFBbEI7QUFDSDtBQUNKO0FBQ0o7O0FBRUQsUUFBRyxDQUFDakUsTUFBTSxDQUFDMkMsUUFBWCxFQUFxQjtBQUNqQixVQUFHLEtBQUszQixHQUFMLENBQVNvRCxDQUFULEdBQWEsR0FBaEIsRUFBcUI7QUFDakIsYUFBS3JELEtBQUwsQ0FBV3NELE1BQVgsR0FBb0JOLElBQUksQ0FBQ08sR0FBTCxDQUFTLEdBQVQsRUFBYyxJQUFJLENBQUMsS0FBS3RELEdBQUwsQ0FBU29ELENBQVQsR0FBYSxHQUFkLElBQXFCLElBQXZDLENBQXBCO0FBQ0EsYUFBS3JELEtBQUwsQ0FBV3dELE1BQVgsR0FBb0JSLElBQUksQ0FBQ08sR0FBTCxDQUFTLEdBQVQsRUFBYyxJQUFJLENBQUMsS0FBS3RELEdBQUwsQ0FBU29ELENBQVQsR0FBYSxHQUFkLElBQXFCLElBQXZDLENBQXBCO0FBQ0gsT0FIRCxNQUdPO0FBQ0gsYUFBS3JELEtBQUwsQ0FBV3NELE1BQVgsR0FBb0IsQ0FBcEI7QUFDQSxhQUFLdEQsS0FBTCxDQUFXd0QsTUFBWCxHQUFvQixDQUFwQjtBQUNIO0FBQ0o7QUFFSjtBQXhMSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZ2xvYmFsID0gcmVxdWlyZShcImdsb2JhbFwiKTtcbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHJlc3RhcnQ6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlXG4gICAgICAgIH0sXG4gICAgICAgIG51bToge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkxhYmVsXG4gICAgICAgIH0sXG4gICAgICAgIG1hcDoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcbiAgICAgICAgfSxcbiAgICAgICAgYmxvY2s6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IFtdLFxuICAgICAgICAgICAgdHlwZTogY2MuUHJlZmFiXG4gICAgICAgIH0sXG4gICAgICAgIHRpcHM6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5MYWJlbFxuICAgICAgICB9LFxuICAgICAgICBzdGFnZToge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcbiAgICAgICAgfSxcbiAgICAgICAgYm9vOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuTm9kZVxuICAgICAgICB9LFxuICAgICAgICBiZzoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyB1c2UgdGhpcyBmb3IgaW5pdGlhbGl6YXRpb25cbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBpZih0eXBlb2Yod3gpICE9IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHd4LnNob3dTaGFyZU1lbnUoe1xuICAgICAgICAgICAgICB3aXRoU2hhcmVUaWNrZXQ6IHRydWVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB3eC51cGRhdGVTaGFyZU1lbnUoe1xuICAgICAgICAgICAgICB3aXRoU2hhcmVUaWNrZXQ6IHRydWVcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB3eC5vblNoYXJlQXBwTWVzc2FnZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIC8vIOeUqOaIt+eCueWHu+S6huKAnOi9rOWPkeKAneaMiemSrlxuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiAn5bCP5Y2c5LiO6Iqx55Sf55qE5pWF5LqL77yM5oOz6KaB6K6y57uZ5L2g5ZCs4oCm4oCmJyxcbiAgICAgICAgICAgICAgICBpbWFnZVVybDogXCJyZXMvcmF3LWFzc2V0cy9UZXh0dXJlL3NoYXJlL3MzLnBuZ1wiLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICflsI/ljZw6JyxcbiAgICAgICAgICAgICAgICBjb250ZW50OiAn6L+Z6YeM5piv57uD5Lmg5qih5byP77yM5rKh5pyJ5YiG5pWw5ZKM5o6S6KGM77yM5Y+q5pyJ5LiA5Liq5bCP5pWF5LqL77yM6ZqP5pe25Y+v5Lul54K55Ye75bem5LiL6KeS5oyJ6ZKu6YCA5Ye6JyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uIChhcmd1bWVudCkge1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBnbG9iYWwuZ2FtZSA9IHRoaXM7XG5cbiAgICAgICAgdmFyIG1hbmFnZXIgPSBjYy5kaXJlY3Rvci5nZXRDb2xsaXNpb25NYW5hZ2VyKCk7XG4gICAgICAgIG1hbmFnZXIuZW5hYmxlZCA9IHRydWU7XG4gICAgICAgIC8vIG1hbmFnZXIuZW5hYmxlZERlYnVnRHJhdyA9IHRydWU7XG4gICAgICAgIC8vIG1hbmFnZXIuZW5hYmxlZERyYXdCb3VuZGluZ0JveCA9IHRydWU7XG5cbiAgICAgICAgZ2xvYmFsLmJvbnVzID0gMDtcblxuICAgICAgICB0aGlzLmJvby5vcmlfeHYgPSAxO1xuICAgICAgICB0aGlzLmJvby5vcmlfeGEgPSAwLjI7XG4gICAgICAgIHRoaXMuYm9vLnh2ID0gdGhpcy5ib28ub3JpX3h2O1xuICAgICAgICB0aGlzLmJvby54YSA9IHRoaXMuYm9vLm9yaV94YTtcblxuICAgICAgICBnbG9iYWwuZGlzdGFuY2UgPSAwO1xuICAgICAgICBnbG9iYWwubnVtID0gMDtcbiAgICAgICAgZ2xvYmFsLmdhbWVvdmVyID0gZmFsc2U7XG5cbiAgICAgICAgZ2xvYmFsLndvcmQgPSAwO1xuXG4gICAgICAgIHRoaXMuZWRnZSA9IDA7XG5cbiAgICAgICAgdGhpcy5ib29fbW92ZSA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMubm9kZS5vbigndG91Y2hzdGFydCcsIGZ1bmN0aW9uICggZXZlbnQgKSB7XG4gICAgICAgICAgICBpZighZ2xvYmFsLmdhbWVvdmVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ib28ueHYgPSB0aGlzLmJvby5vcmlfeHY7XG4gICAgICAgICAgICAgICAgdGhpcy5ib28ueGEgPSB0aGlzLmJvby5vcmlfeGE7XG4gICAgICAgICAgICAgICAgdGhpcy5ib29fbW92ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICB0aGlzLm5vZGUub24oJ3RvdWNoZW5kJywgZnVuY3Rpb24gKCBldmVudCApIHtcbiAgICAgICAgICAgIHRoaXMuYm9vX21vdmUgPSBmYWxzZTtcbiAgICAgICAgfSwgdGhpcyk7XG5cblxuICAgICAgICB0aGlzLnJlc3RhcnQub24oJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbiAoIGV2ZW50ICkge1xuICAgICAgICAgICAgY2MuZ2FtZS5yZXN0YXJ0KCk7XG4gICAgICAgIH0sIHRoaXMpO1xuXG4gICAgfSxcblxuICAgIHNldEJMb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGJsb2NrID0gY2MuaW5zdGFudGlhdGUodGhpcy5ibG9ja1swXSk7XG4gICAgICAgIGJsb2NrLnNldFBvc2l0aW9uKGdsb2JhbC5kaXN0YW5jZSArIDQwMCwgLTEwMCk7XG4gICAgICAgIGJsb2NrLm1vZGUgPSBcImMxXCI7XG5cbiAgICAgICAgYmxvY2sucGFyZW50ID0gdGhpcy5tYXA7XG4gICAgfSxcblxuICAgIHNldE51bTogZnVuY3Rpb24obnVtKSB7XG4gICAgICAgIGdsb2JhbC5udW0gKz0gbnVtICsgZ2xvYmFsLmJvbnVzO1xuICAgICAgICB0aGlzLm51bS5zdHJpbmcgPSBnbG9iYWwubnVtO1xuICAgIH0sXG5cbiAgICBzZXRUaXA6IGZ1bmN0aW9uKHN0cikge1xuICAgICAgICB0aGlzLnRpcHMuc3RyaW5nID0gc3RyO1xuICAgIH0sXG5cbiAgICBlbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBnbG9iYWwuZ2FtZW92ZXIgPSB0cnVlO1xuXG4gICAgICAgIGlmKHR5cGVvZih3eCkgIT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ+Wwj+WNnDonLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICfov5Tlm57kuLvoj5zljZXlkq9+JyxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNjLmdhbWUucmVzdGFydCgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogZnVuY3Rpb24gKGFyZ3VtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGNjLmdhbWUucmVzdGFydCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8vIGNhbGxlZCBldmVyeSBmcmFtZSwgdW5jb21tZW50IHRoaXMgZnVuY3Rpb24gdG8gYWN0aXZhdGUgdXBkYXRlIGNhbGxiYWNrXG4gICAgdXBkYXRlOiBmdW5jdGlvbiAoZHQpIHtcblxuICAgICAgICAvKnZhciBjb2xvciA9IHRoaXMuYmcuY29sb3I7XG4gICAgICAgIGlmIChjb2xvci5lcXVhbHMoY2MuQ29sb3IuQkxBQ0spKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0qL1xuICAgICAgICAvLyB0aGlzLnJhdGlvICs9IGR0ICogMC4wMTtcbiAgICAgICAgLy8gdGhpcy5iZy5jb2xvciA9IGNjLkNvbG9yLldISVRFLmxlcnAoY2MuQ29sb3IuV0hJVEUsIHRoaXMucmF0aW8pO1xuXG4gICAgICAgIGlmKHRoaXMuYm9vX21vdmUpIHtcbiAgICAgICAgICAgIGdsb2JhbC5kaXN0YW5jZSArPSB0aGlzLmJvby54djtcbiAgICAgICAgICAgIHRoaXMubWFwLnggLT0gdGhpcy5ib28ueHY7XG4gICAgICAgICAgICB0aGlzLmJvby54diArPSB0aGlzLmJvby54YTtcbiAgICAgICAgICAgIC8vIHRoaXMuYm9vLnh2ID0gTWF0aC5taW4odGhpcy5ib28ueHYsIDEwKVxuXG4gICAgICAgICAgICBpZihnbG9iYWwuZGlzdGFuY2UgPiB0aGlzLmVkZ2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVkZ2UgKz0gMjAwICsgTWF0aC5zZWVkZWRSYW5kb20oKSAqIDUwICsgdGhpcy5ib28ueHYgKiB0aGlzLmJvby54djtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEJMb2NrKCk7XG4gICAgICAgICAgICAgICAgaWYoZ2xvYmFsLm51bSAlIDUwID4gNDUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IGNjLnRpbnRUbygyLCBNYXRoLnNlZWRlZFJhbmRvbSgpICogMjU1LCBNYXRoLnNlZWRlZFJhbmRvbSgpICogMjU1LCBNYXRoLnNlZWRlZFJhbmRvbSgpICogMjU1KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5iZy5ydW5BY3Rpb24oYWN0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZighZ2xvYmFsLmdhbWVvdmVyKSB7XG4gICAgICAgICAgICBpZih0aGlzLmJvby55ID4gNDAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZS5zY2FsZVggPSBNYXRoLm1heCgwLjIsIDEgLSAodGhpcy5ib28ueSAtIDQwMCkgLyAxMDAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlLnNjYWxlWSA9IE1hdGgubWF4KDAuMiwgMSAtICh0aGlzLmJvby55IC0gNDAwKSAvIDEwMDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YWdlLnNjYWxlWCA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFnZS5zY2FsZVkgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9LFxufSk7XG4iXX0=